# v1.0.0l — Archive fetchers online

## Context
- Star Hub previously listed only resolver output because the MAST and SDSS adapters were stubbed.
- Frequency/energy ingestion landed last run; we now need credible archive metadata to exercise those paths.

## Changes
- Implemented `server/fetchers/mast.search_products` using `astroquery.mast.Observations`, normalising wavelength bounds, collecting provenance, and constructing download links from product lists.
- Built `server/fetchers/sdss.fetch_by_specobjid` / `fetch_by_plate` to query SDSS metadata, fetch calibrated spectra via `get_spectra`, and derive wavelength coverage and resolving power from FITS tables.
- Added regression tests (`tests/test_fetchers_mast.py`, `tests/test_fetchers_sdss.py`) that monkeypatch astroquery clients with synthetic tables/HDU lists to validate normalisation without network access.
- Updated `atlas/fetchers_overview.md`, bumped `pyproject.toml` to `1.0.0.dev12`, and recorded the run in patch notes and handoff.

## Decisions
- Treated MAST wavelength bounds as metres when below 1e-2 to safely normalise to nanometres without double-scaling typical nm values.
- Surfaced standard SDSS flux units (`1e-17 erg s^-1 cm^-2 Å^-1`) explicitly while leaving DOI fields null until product-level identifiers are available.
- Closed surplus FITS handles defensively after extracting metadata to avoid file descriptor leaks during batch fetches.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Ensures future archive work has deterministic wavelength/resolution metadata, guarding against misclassified coverage or missing download links.
- Provides offline safety so CI failures won't arise when astroquery or network access is unavailable.

## Follow-ups
- Wire the new Product outputs into the Star Hub UI and ingestion pipeline so analysts can pull spectra directly into overlays.
- Expand DOI/citation capture once mission-specific metadata is catalogued.
- Evaluate caching strategies for frequently accessed products to reduce redundant archive calls.

## Checklist
- [x] Atlas updated (`atlas/fetchers_overview.md`)
- [x] Patch notes added (`PATCH_NOTES/PATCH_NOTES_v1.0.0(l).md`)
- [x] Handoff updated (`handoffs/HANDOFF_v1.0.0(l).md`)
- [x] Tests added (`tests/test_fetchers_mast.py`, `tests/test_fetchers_sdss.py`)
