# v1.0.0g â€” Error-aware ASCII ingestion

## Context
- Goal: stop uploads with leading `Flux_Error`/`Wavelength_Error` columns from failing detection or plotting the
  wrong axis after the previous alias broadening.
- Pain points: alias matching still grabbed the first token match, so uncertainty columns appearing before the
  primary flux/wavelength fields were misclassified; provenance then referenced the wrong headers and the UI
  displayed error arrays instead of science data.

## Changes
- Introduced a scored alias matcher that rewards exact/prefix matches while penalising uncertainty tokens so the
  loader prefers true data columns over error variants even when they appear later in the file.
- Detected uncertainty columns up-front, excluded them from alias/unit-hint/numeric resolution for wave/flux, and
  prioritised flux-like errors when selecting the single propagated uncertainty channel.
- Expanded the flux alias vocabulary (signal, reflectance, transmission, absorbance, throughput) and added a
  regression covering error-prefixed headers to confirm provenance and arrays point at the correct columns.

## Decisions
- Avoided dropping uncertainty columns entirely so numeric fallbacks can still choose them when no better flux
  candidate exists, but bias the scoring toward real flux fields to keep behaviour predictable for well-formed
  exports.
- Reused the broadened alias/unit-hint pipeline, simply layering the error penalties rather than introducing new
  configuration switches to keep ingestion deterministic.
- Continued the 1.0.0 cadence with `1.0.0g` / `1.0.0.dev7` so packaging remains PEP 440 compliant while aligning
  with the visible badge.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Ensures datasets exporting `Flux_Error`/`Wavelength_Error` ahead of their primaries no longer derail ingestion
  or mislabel provenance, restoring end-to-end uploads for the user's reported CSVs.
- Keeps previous unit-hint, headerless, and alias resilience intact while extending coverage to signal/throughput
  style flux labels.

## Follow-ups
- Capture wavelength-error columns in provenance metadata for future debugging without treating them as
  numeric axes.
- Expand preferred token lists with frequency/energy vocabulary once representative uploads appear.
- Audit historical release artefacts to align 0.1.x naming with the 1.0.x cadence.

## Checklist
- [x] Atlas updated (`atlas/ingest_ascii.md`)
- [x] Patch notes & handoff updated (`PATCH_NOTES_v1.0.0(g).md`, `HANDOFF_v1.0.0(g).md`)
- [x] Tests added/updated (`tests/test_ascii_loader.py`)
