# v0.1.0e â€” Headerless ASCII heuristics

## Context
- Goal: restore automatic column detection for ASCII uploads where exports omit descriptive headers or
  include leading numeric rows.
- Pain points: v0.1.0d required explicit wavelength/flux aliases, so headerless CSV files lost their first
  data row to pandas' inferred header and ingestion failed, plus packaging metadata broke editable
  installs (`0.1.0d0` was not PEP 440 compliant).

## Changes
- Added a headerless retry path that re-parses files without headers when the initial column labels are
  numeric, assigning placeholder `column_*` names so we keep every data row.
- Implemented numeric heuristics that score monotonic coverage to choose wavelength columns and select the
  remaining numeric series as flux, with provenance noting the detection strategy, row counts, and whether
  the upload lacked headers.
- Coerced numeric columns safely, removed rows missing finite wavelength/flux pairs, and defaulted guessed
  wavelength units to `unknown` instead of surfacing placeholder column labels.
- Expanded regression coverage to assert headerless CSV ingestion, provenance metadata, and unit fallback.
- Updated the ASCII ingest atlas entry to document the headerless retry, numeric heuristics, row trimming,
  and provenance enrichments.
- Bumped packaging metadata to `0.1.0.dev5` while the UI badge advances to `0.1.0e`, fixing pip editable
  installs.

## Decisions
- Prefer monotonic numeric heuristics only when alias matching fails so we maintain backwards
  compatibility for descriptive exports while rescuing bare numeric dumps.
- Treat inferred wavelength units as `unknown` whenever the header is synthetic or numeric to avoid
  exposing placeholder column names in the UI.
- Record detection method, headerless flag, and retained row counts in provenance to aid debugging and
  regression triage.
- Adopt `0.1.0.dev5` in `pyproject.toml` while keeping the user-facing letter suffix so packaging remains
  PEP 440 compliant without disrupting UI messaging.

## Tests & Evidence
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Prevents pandas from eating the first data row when uploads lack headers, ensuring wavelength/flux
  arrays stay aligned with source files.
- Avoids reintroducing bogus wavelength units (e.g., `column_0`) into provenance and downstream plots.
- Guards against silent row-count mismatches by dropping invalid entries and surfacing retained totals.

## Follow-ups
- Monitor additional ASCII samples for descending or multi-segment wavelength patterns that may require
  refined heuristics.
- Evaluate numeric fallbacks for uncertainty columns once representative exports are available.
- Draft UI guidance explaining the `unknown` unit badge when heuristics trigger.

## Checklist
- [x] Atlas updated (`atlas/ingest_ascii.md`)
- [x] Patch notes & handoff updated (`PATCH_NOTES_v0.1.0(e).md`, `HANDOFF_v0.1.0(e).md`)
- [x] Tests added/updated (`tests/test_ascii_loader.py`)
