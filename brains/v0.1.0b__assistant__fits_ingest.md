# v0.1.0b — FITS ingestion

## Context
- Goal for this run: implement the FITS ingestion pipeline, wire it into the Overlay tab, and
  expand documentation/continuity artefacts for v0.1.0b.
- Starting point: v0.1.0a delivered ASCII ingestion, canonical maths, SIMBAD resolver, export, and
  baseline docs/tests.

## Changes
- `server/ingest/fits_loader.py`: full FITS loader with WCS-aware wavelength grids, uncertainty
  detection, provenance logging, and metadata harvesting (target/instrument/frame/etc.).
- `server/ingest/canonicalize.py`: added `canonicalize_fits` and shared
  `normalise_wavelength_unit` helper so FITS spectra land on the vacuum-nm baseline with consistent
  provenance.
- `app/ui/overlay.py`: uploader now accepts FITS files; routes them through the new ingest path and
  handles mixed uploads while keeping dedupe messaging.
- `tests/test_fits_loader.py`: regression coverage for FITS metadata extraction and air↔vacuum
  conversion.
- Seeded `data/examples/example_spectrum.fits` plus atlas/docs/readme/patch notes updates for the
  new capability; version bumped to 0.1.0b across config and packaging metadata.

## Decisions
- Stored key WCS keywords in provenance to aid replay/audit without serialising full headers.
- Treated `.fits/.fit/.fts` as supported extensions in the Streamlit uploader; unsupported suffixes
  fall back to a user-facing warning.
- Added air/vacuum detection heuristics based on `CTYPE1`, `AIRORVAC`, and `VACUUM` header tags to
  capture common observatory conventions without extra user input.

## Tests & Evidence
- `ruff check . --fix`
- `black .`
- `mypy .`
- `pytest`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-Brains.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- New tests ensure FITS air-wavelength spectra always record `air_to_vacuum` provenance, preventing
  silent baseline drift.
- Loading a FITS file with an error HDU verifies uncertainty alignment so downstream math keeps
  uncertainty propagation intact.

## Follow-ups
- Implement FITS-specific canonical helpers for more complex dispersion solutions (non-linear WCS,
  alternate axes) when needed.
- Build archive fetchers (MAST/SDSS) using the new ingest model; integrate fixture-backed tests.
- Flesh out replay CLI and Docs content beyond the high-level overview.

## Checklist
- [x] Atlas updated
- [x] Docs updated
- [x] Tests updated
