# v1.0.0k — Transform provenance surfaced in the UI

## Context
- Goal: extend the Overlay trace manager to expose downstream provenance (unit conversions, air↔vacuum,
  differential math) so analysts can audit how each spectrum was transformed without exporting bundles.
- Prior state: the UI displayed axis-family badges but required manifest inspection to understand
  subsequent conversions or differential operations.

## Changes
- Added transform-note extraction in `app/ui/overlay.py`, rendering unit conversions, air→vacuum
  corrections, and differential steps beneath each trace checkbox.
- Expanded regression coverage in `tests/test_overlay_axis_summary.py` for air-wavelength uploads and
  differential products to keep the UI audit trail deterministic.
- Updated docs (overview + atlas UI contract), patch notes, handoff, and version metadata to ship
  `1.0.0k` / `1.0.0.dev11` describing the new provenance summaries.

## Decisions
- Reused existing provenance events instead of minting new metadata, ensuring historical traces benefit
  immediately and keeping manifests stable.
- Displayed transform notes inline with axis captions to keep the provenance context adjacent to the
  visibility controls analysts already use.
- Formatted epsilon values with general notation (`{epsilon:g}`) for compact readability while retaining
  numeric fidelity.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Analysts immediately see whether an upload underwent air→vacuum conversion or differential math,
  avoiding misinterpretation of derived traces during live review sessions.
- Axis-unit conversions are now evident in the UI, preventing confusion when uploads arrive in Angstroms
  or frequency/energy units.
- Differential operations log their operands and epsilon values inline, making it clear how a derived
  trace was constructed.

## Follow-ups
- Extend provenance display to cover future transform events (e.g., resolution matching) once they record
  dedicated `ProvenanceEvent` entries.
- Broaden Docs tab content to include troubleshooting scenarios that reference the new UI provenance
  cues.
- Continue archive fetcher development so real-world products exercise the enhanced provenance display.

## Checklist
- [x] Atlas updated (`atlas/ui_contract.md`)
- [x] Patch notes & handoff updated (`PATCH_NOTES_v1.0.0(k).md`, `HANDOFF_v1.0.0(k).md`)
- [x] Tests added/updated (`tests/test_overlay_axis_summary.py`)
