# v1.0.0h — Frequency & energy ingestion

## Context
- Goal: let ASCII uploads expressed in frequency (Hz/THz) or energy (eV) land on the wavelength
  baseline without manual relabelling.
- Pain points: the loader only recognised wavelength/wavenumber units, so frequency- or
  energy-based spectra failed detection or produced nonsense wavelengths after canonicalisation.

## Changes
- Added frequency/energy aliases and unit hints to the ASCII resolver so columns like
  `Axis (THz)` or `PhotonEnergy (eV)` map to the wavelength slot via alias scoring or unit hints.
- Extended `server/math/transforms` with Hz↔nm and eV↔nm helpers plus round-trip coverage and
  normalised the canonical unit mapper to recognise the new units.
- Wrote regressions for the ingestion + canonicalisation path and updated the atlas/docs and
  release metadata to `1.0.0h` / `1.0.0.dev8`.

## Decisions
- Prefer unit hints when headers are generic (`Axis`, `Value`) so we keep deterministic detection
  while still rescuing frequency-labelled exports.
- Limited energy support to eV for now; follow-up will extend to keV/µm once representative data
  arrives to avoid guessing scale factors.
- Kept provenance semantics intact by reusing the existing detection flags rather than introducing
  new variants for the additional unit families.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Allows THz/Hz exports to ingest without misclassifying the axis or triggering "No wavelength" errors.
- Ensures eV spectra convert to the canonical nm baseline so overlays and exports stay honest.
- Keeps previous wavelength/wavenumber resilience, including uncertainty filtering, untouched.

## Follow-ups
- Add scaling-aware mappings for keV/MeV energy axes and other frequency units once encountered.
- Surface the detected frequency/energy unit in provenance metadata for richer diagnostics.
- Continue the archive fetcher build-out so frequency-domain products from MAST/SDSS can exercise
  the new pathways end-to-end.

## Checklist
- [x] Atlas updated (`atlas/ingest_ascii.md`, `atlas/transforms.md`)
- [x] Patch notes & handoff updated (`PATCH_NOTES_v1.0.0(h).md`, `HANDOFF_v1.0.0(h).md`)
- [x] Tests added/updated (`tests/test_ascii_loader.py`, `tests/test_transforms.py`)
