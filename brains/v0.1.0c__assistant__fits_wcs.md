# v0.1.0c — FITS multi-extension ingestion

## Context
- Goal: extend the FITS ingest path to handle SDSS-style multi-extension tables and non-linear/tabular
  wavelength solutions while keeping provenance intact.
- Starting point: v0.1.0b supported single-HDU FITS spectra with linear WCS and basic uncertainty
  harvesting.

## Changes
- Updated `server/ingest/fits_loader.py` to discover companion wavelength HDUs, translate `ivar`
  columns into σ arrays, and fall back to `specutils` loaders when the dispersion axis cannot be
  derived from local headers.
- Logged provenance for the new branches (companion HDUs vs. specutils) and hardened uncertainty
  detection to inspect the active HDU before scanning siblings.
- Added regression tests for multi-extension FITS files and specutils-backed ingestion plus atlas
  updates describing the new coverage.

## Decisions
- Prefer keeping the native parsing path first to avoid the overhead of specutils unless necessary,
  but capture in provenance when the fallback is used so replay tooling can mirror the decision.
- Treat inverse-variance arrays as first-class uncertainties, converting to σ to align with existing
  propagation rules.

## Tests & Evidence
- `python -m pytest tests/test_fits_loader.py`
- `python -m pytest tests`
- `ruff check .`
- `black --check .`
- `mypy .`

## Regressions Prevented
- Regression coverage for SDSS-style FITS ensures future refactors retain support for companion
  wavelength tables and inverse-variance arrays.
- Specutils fallback test prevents silent failures when ingesting non-linear WCS products that lack
  conventional FITS keywords.

## Follow-ups
- Implement archive fetchers (MAST/SDSS) to exercise the ingest path with live catalog products.
- Extend replay tooling to recognise specutils-derived provenance for deterministic rebuilds.
- Investigate caching of specutils loaders to amortise cost when ingesting many spectra in a session.

## Checklist
- [x] Atlas updated
- [ ] Docs updated
- [x] Tests updated
