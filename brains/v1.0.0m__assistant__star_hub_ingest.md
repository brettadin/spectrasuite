# v1.0.0m â€” Star Hub archive ingestion

## Context
- Previous run exposed MAST/SDSS fetchers but Star Hub only surfaced resolver metadata without a way
  to ingest archive products.
- Analysts needed to pivot into external tools to download spectra, defeating the provenance and
  reproducibility guardrails in the app.

## Changes
- Built `server.fetchers.ingest_product.ingest_product` to download archive payloads (FITS first,
  ASCII fallback), route them through existing canonicalisation, and merge `Product` metadata into the
  resulting `TraceMetadata` with a provenance event for the fetch.
- Reworked the Star Hub tab to hold resolver state, run MAST region searches, expose SDSS SpecObjID
  and plate/MJD/fiber lookups, and let analysts add any returned product to the overlay with one
  button.
- Extended atlas/docs to describe the new archive ingest flow and bumped version metadata to
  `1.0.0m` / `1.0.0.dev13`.

## Decisions
- Defaulted downloads to FITS ingestion with an ASCII retry so we cover the dominant archive products
  without special-casing providers; future runs can add mission-specific handlers if needed.
- Carried `Product` metadata into trace metadata only when canonical ingestion leaves a field empty so
  archive hints don't clobber authoritative FITS headers.
- Suppressed duplicate SDSS entries in the UI to keep the trace manager clean while still allowing
  multiple distinct fetches.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Brains.py`
- `python tools/verifiers/Verify-Handoff.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Keeps archive ingests inside the app, preserving provenance and dedupe ledger behaviour for external
  spectra.
- Avoids manual downloads that could silently bypass axis conversion and transform logging.

## Follow-ups
- Investigate caching or streaming downloads for large archive payloads so UI remains responsive.
- Expand citation/DOI capture once authoritative identifiers are catalogued per mission.
- Extend export manifests to embed archive download URIs for full replay.

## Checklist
- [x] Atlas updated (`atlas/fetchers_overview.md`)
- [x] Patch notes added (`PATCH_NOTES/PATCH_NOTES_v1.0.0(m).md`)
- [x] Handoff updated (`handoffs/HANDOFF_v1.0.0(m).md`)
- [x] Tests added (`tests/test_fetcher_ingest.py`)

