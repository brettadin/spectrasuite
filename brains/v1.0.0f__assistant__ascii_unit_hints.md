# v1.0.0f — Unit-aware ASCII detection

## Context
- Goal: fix uploads where wavelength/flux headers use obscure labels (e.g., `Channel (µm)`, `Signal (photons/s)`)
  so the loader still identifies the numeric axes without manual renaming.
- Pain points: the previous heuristics only matched explicit aliases or numeric fallbacks, so unit-only
  hints (µm, Å, cm⁻¹, photons) failed to resolve wavelength/flux columns and ingestion bailed out in the UI.

## Changes
- Introduced token-aware alias matching and widened the wavelength/flux/uncertainty synonym lists so suffixes
  like `Flux_Total`, plurals (`intensities`), and noise metrics map correctly.
- Canonicalised unit glyphs (µ → `u`, Å → `angstrom`) and added unit-hint detection before the numeric
  heuristic, logging a `unit_hint` provenance flag whenever column selection relied on unit cues.
- Extended provenance, atlas documentation, and tests to reflect the new detection flow and to cover µm and
  cm⁻¹/photons datasets.
- Bumped release artefacts to `1.0.0f` and packaging metadata to `1.0.0.dev6` to keep PEP 440 compliance
  while aligning with the 1.0.x cadence.

## Decisions
- Prioritise alias/token matches, then unit hints, and only fall back to numeric heuristics so we preserve
  deterministic behaviour for well-labelled exports while rescuing ambiguous ones.
- Treat very short aliases (`nm`, `um`, `aa`) as exact matches to avoid misclassifying columns that merely
  contain those tokens as suffixes.
- Surface the provided unit string when detection uses alias/unit hints, but continue reporting `unknown`
  for synthetic headers originating from numeric fallbacks.

## Tests & Evidence
- `python -m pip install -e .`
- `ruff check .`
- `black --check .`
- `mypy .`
- `PYTHONPATH=. pytest -q`
- `python tools/verifiers/Verify-Atlas.py`
- `python tools/verifiers/Verify-PatchNotes.py`
- `python tools/verifiers/Verify-Handoff.py`
- `python tools/verifiers/Verify-Brains.py`
- `PYTHONPATH=. python tools/verifiers/Verify-UI-Contract.py`

## Regressions Prevented
- Ensures µm-labelled and cm⁻¹/photons exports ingest cleanly without manual renaming, restoring data
  detection for observatory pipelines that rely on unit-only headers.
- Prevents provenance from incorrectly reporting alias-based detection when units were used, aiding support
  triage.
- Avoids raising "No numeric columns detected" when columns were numeric but only distinguishable by units.

## Follow-ups
- Monitor additional real-world exports for further unit synonyms (e.g., energy- or frequency-based axes)
  that may warrant future hint lists.
- Investigate adaptive heuristics for uncertainty units once representative datasets arrive.
- Continue migrating historical release artefacts from 0.1.x naming to the 1.0.x cadence.

## Checklist
- [x] Atlas updated (`atlas/ingest_ascii.md`)
- [x] Patch notes & handoff updated (`PATCH_NOTES_v1.0.0(f).md`, `HANDOFF_v1.0.0(f).md`)
- [x] Tests added/updated (`tests/test_ascii_loader.py`)
